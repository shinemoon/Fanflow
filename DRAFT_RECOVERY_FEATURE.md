# 编辑器草稿恢复功能

## 功能概述
在 `editor.js` 中实现了编辑器内容的自动保存和恢复功能，确保用户在编辑过程中窗口意外关闭后能够恢复之前的内容。

## 实现的功能

### 1. 自动保存机制
- **文本自动保存**: 用户输入文本后1秒自动保存到本地存储
- **图片自动保存**: 上传图片后立即保存（包括文件内容的Base64编码）
- **关闭时保存**: 窗口关闭、按ESC键或点击遮罩层时自动保存

### 2. 数据恢复机制
- **启动时检测**: 打开新建编辑器时自动检测是否有保存的草稿
- **内容恢复**: 自动恢复保存的文本内容和上传的图片
- **提示信息**: 恢复草稿时显示保存时间提示

### 3. 保存的数据内容
- 文本内容 (`text`)
- 是否有图片 (`hasImage`)
- 保存时间戳 (`timestamp`)
- 图片数据 (`imageData`)
  - 文件名 (`name`)
  - 文件大小 (`size`)
  - 文件类型 (`type`)
  - 图片Base64数据 (`dataUrl`)

### 4. 清除机制
- **发布成功后**: 自动清除保存的草稿
- **手动重置**: 用户点击图片重置按钮后更新保存状态

## 使用场景
1. 用户正在编辑长文本，突然浏览器崩溃或意外关闭
2. 用户上传了图片但还没发布，需要临时关闭浏览器
3. 用户在编辑过程中切换到其他应用，后来忘记了编辑内容

## 技术细节

### 存储位置
使用浏览器的 `localStorage` 存储，键名为 `fanfou_editor_draft`

### 数据结构
```javascript
{
  "text": "用户输入的文本内容",
  "hasImage": true,
  "timestamp": 1691825234567,
  "imageData": {
    "name": "image.jpg",
    "size": 102400,
    "type": "image/jpeg",
    "dataUrl": "data:image/jpeg;base64,..."
  }
}
```

### 防抖机制
文本输入采用1秒防抖，避免频繁保存影响性能。

### 限制说明
- 图片大小受localStorage容量限制（通常5-10MB）
- 只在"新建"模式下恢复草稿，转发和回复模式不受影响
- 草稿仅保存在本地浏览器，不会同步到其他设备

## 用户体验改进
- 恢复草稿时显示友好的时间提示
- 图片恢复包括完整的文件信息显示
- 发布成功后自动清理草稿，避免下次误恢复
- 无感知的自动保存，不影响正常编辑流程
